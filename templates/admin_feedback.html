{% extends "base.html" %}

{% block title %}Feedback Dashboard - CE Tracker Admin{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>ğŸ“¬ Feedback Dashboard</h1>
        <div class="admin-stats">
            <div class="admin-stat">
                <div class="admin-stat-label">Total</div>
                <div class="admin-stat-value">{{ total_count }}</div>
            </div>
            <div class="admin-stat">
                <div class="admin-stat-label">Unread</div>
                <div class="admin-stat-value unread">{{ unread_count }}</div>
            </div>
        </div>
    </div>

    <div class="admin-filters">
        <form method="GET" action="{{ url_for('view_feedback') }}" class="filter-form">
            <input type="hidden" name="key" value="{{ admin_key }}">
            <div class="filter-group">
                <label for="type">Type:</label>
                <select id="type" name="type" onchange="this.form.submit()">
                    <option value="">All Types</option>
                    <option value="bug" {% if filter_type == 'bug' %}selected{% endif %}>ğŸ› Bug Report</option>
                    <option value="feature" {% if filter_type == 'feature' %}selected{% endif %}>ğŸ’¡ Feature Request</option>
                    <option value="general" {% if filter_type == 'general' %}selected{% endif %}>ğŸ‘ General</option>
                    <option value="question" {% if filter_type == 'question' %}selected{% endif %}>â“ Question</option>
                    <option value="other" {% if filter_type == 'other' %}selected{% endif %}>ğŸ“ Other</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="read">Status:</label>
                <select id="read" name="read" onchange="this.form.submit()">
                    <option value="">All</option>
                    <option value="unread" {% if filter_read == 'unread' %}selected{% endif %}>Unread Only</option>
                    <option value="read" {% if filter_read == 'read' %}selected{% endif %}>Read Only</option>
                </select>
            </div>
            {% if filter_type or filter_read %}
            <a href="{{ url_for('view_feedback', key=admin_key) }}" class="btn btn-secondary btn-sm">Clear Filters</a>
            {% endif %}
        </form>
    </div>

    {% if feedback_list %}
    <div class="feedback-list">
        {% for feedback in feedback_list %}
        <div class="feedback-item {% if not feedback.is_read %}unread{% endif %} type-{{ feedback.feedback_type }}">
            <div class="feedback-item-header">
                <div class="feedback-item-meta">
                    <span class="feedback-item-name">{{ feedback.name }}</span>
                    <a href="mailto:{{ feedback.email }}" class="feedback-item-email">{{ feedback.email }}</a>
                </div>
                <div class="feedback-item-info">
                    {% if not feedback.is_read %}
                    <span class="unread-badge">NEW</span>
                    {% endif %}
                    <span class="feedback-type-badge {{ feedback.feedback_type }}">
                        {% if feedback.feedback_type == 'bug' %}ğŸ› Bug{% endif %}
                        {% if feedback.feedback_type == 'feature' %}ğŸ’¡ Feature{% endif %}
                        {% if feedback.feedback_type == 'general' %}ğŸ‘ General{% endif %}
                        {% if feedback.feedback_type == 'question' %}â“ Question{% endif %}
                        {% if feedback.feedback_type == 'other' %}ğŸ“ Other{% endif %}
                    </span>
                    <span class="feedback-item-date">{{ feedback.created_at.strftime('%b %d, %Y at %I:%M %p') }}</span>
                </div>
            </div>
            <div class="feedback-item-body">
                <p class="feedback-item-message">{{ feedback.message }}</p>
            </div>
            <div class="feedback-item-actions">
                <form method="POST" action="{{ url_for('toggle_feedback_read', feedback_id=feedback.id, key=admin_key) }}" style="display: inline;">
                    <button type="submit" class="btn btn-secondary btn-sm">
                        {% if feedback.is_read %}Mark Unread{% else %}Mark Read{% endif %}
                    </button>
                </form>
                <a href="mailto:{{ feedback.email }}?subject=RE: Your CE Tracker Feedback" class="btn btn-primary btn-sm">
                    Reply
                </a>
                <form method="POST" action="{{ url_for('delete_feedback', feedback_id=feedback.id, key=admin_key) }}" 
                      style="display: inline;"
                      onsubmit="return confirm('Are you sure you want to delete this feedback?');">
                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-feedback">
        <p>No feedback found{% if filter_type or filter_read %} matching your filters{% endif %}.</p>
        {% if filter_type or filter_read %}
        <p><a href="{{ url_for('view_feedback', key=admin_key) }}">Clear filters</a> to see all feedback.</p>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}

